<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EhrenSache - Dashboard</title>

    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="robots" content="noindex, nofollow">
    <script type="module" src="js/theme.js"></script>
</head>

<body>
     <!-- Hamburger Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    <!-- Login Seite -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <h2>EhrenSache</h2>
            <h3 class ="org-name" id="loginOrgTitle">Mein Verein</h3>
            <form id="loginForm" onsubmit="return false;">
                <div class="form-group">
                    <label for="email">E-Mail</label>
                    <input type="email" id="email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="password">Passwort</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn-login" id="loginBtn">Anmelden</button>
                <div class="error-message" id="loginError"></div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h3>EhrenSache</h3>
                <h4 class="org-name">Mein Verein</h4>
                <div class="user-info">
                    <div>Angemeldet als:</div>
                    <strong id="currentUser">-</strong>
                    <div id="userRole">(-)</div>
                </div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item" data-section="profil">
                    <span>üë§ Mein Profil</span>
                </li>        
                <li class="nav-item" data-section="einstellungen" data-role="admin">
                    <span>‚öôÔ∏è Einstellungen</span>
                </li>
                <li class="nav-item" data-section="benutzer" data-role="admin">
                    <span>üîê Benutzer</span>
                </li>       
                <li class="nav-item" data-section="verwaltung" data-role="manager">
                    <span>üé≠ Gruppenverwaltung</span>
                </li>
                <li class="nav-item active" data-section="mitglieder" data-role="manager">
                    <span>üë• Mitglieder</span>
                </li>     
                <li class="nav-item" data-section="termine">
                    <span>üìÖ Termine</span>
                </li>                                                   
                <li class="nav-item" data-section="anwesenheit">
                    <span>‚úì Anwesenheiten</span>
                </li>
                <li class="nav-item" data-section="antraege">
                    <span>üìã Antr√§ge</span>
                </li>  
                <li class="nav-item" data-section="statistik">
                    <span>üìä Statistik</span>
                </li>                  
            </ul>                        
            <!-- Quick Access Bar -->
            <div class="quick-access-bar">
                <button class="quick-access-btn" id="openPWABtn" title="Check-In App √∂ffnen">
                    üì± Check-In App
                </button>
                <button class="btn-logout" id="logoutBtn">Abmelden</button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
        <!-- Profil Section -->
            <div class="content-section" id="profil">
                <div class="content-header">
                    <h1>Mein Profil</h1>
                </div>

                <div class="profile-container">
                    <!-- Account-Informationen -->
                    <div class="profile-card">
                        <h3>Account-Informationen</h3>
                        <div class="profile-item">
                            <label>E-Mail-Adresse</label>
                            <input type="email" id="profile_email" readonly style="background: #f8f9fa; cursor: not-allowed;">
                            <small style="color: #7f8c8d;">Die E-Mail-Adresse kann nicht ge√§ndert werden</small>
                        </div>
                        <div class="profile-item">
                            <label>Rolle</label>
                            <input type="text" id="profile_role" readonly style="background: #f8f9fa; cursor: not-allowed;">
                        </div>
                        <div class="profile-item" id="profile_member_info" style="display: none;">
                            <label>Verkn√ºpftes Mitglied</label>
                            <input type="text" id="profile_member" readonly style="background: #f8f9fa; cursor: not-allowed;">
                        </div>
                    </div>

                    <!-- Passwort √§ndern -->
                    <div class="profile-card">
                        <h3>Passwort √§ndern</h3>
                        <form id="changePasswordForm">
                            <div class="profile-item">
                                <label for="current_password">Aktuelles Passwort*</label>
                                <input type="password" id="current_password" required>
                            </div>
                            <div class="profile-item">
                                <label for="new_password">Neues Passwort*</label>
                                <input type="password" id="new_password" required minlength="6">
                                <small style="color: #7f8c8d;">Mindestens 6 Zeichen</small>
                            </div>
                            <div class="profile-item">
                                <label for="confirm_password">Passwort best√§tigen*</label>
                                <input type="password" id="confirm_password" required>
                            </div>
                            <button type="submit" class="btn-add" style="margin-top: 10px;">Passwort √§ndern</button>
                        </form>
                    </div>

                    <!-- API-Token -->
                    <div class="profile-card">
                        <h3>API-Token f√ºr Zeiterfassung</h3>
                        <p style="color: #e74c3c; margin-bottom: 15px; font-size: 14px;">
                            ‚ö†Ô∏è Dieser Token wird f√ºr die Check-In App ben√∂tigt. Behandeln Sie diesen wie ein Passwort!
                        </p>
                        <div class="profile-item">
                            <label>API-Token</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div style="flex: 1; position: relative;">
                                    <input type="password" id="profile_token" readonly class="token-hidden"
                                           style="width: 100%; padding: 10px 40px 10px 10px; font-family: monospace;">
                                    <button onclick="toggleProfileTokenVisibility()" id="toggleProfileTokenBtn" type="button"
                                            style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 20px; padding: 5px 10px; color: #7f8c8d;">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <button onclick="copyProfileToken()" type="button" class="btn-add" style="margin: 0; width: auto;">üìã Kopieren</button>
                            </div>
                        </div>
                        <div id="profileTokenExpiryInfo" style="display: block; margin-top: 5px; font-size: 12px;"></div>
                        <button onclick="regenerateProfileToken()" type="button" class="action-btn btn-delete" style="margin-top: 10px;">
                            üîÑ Neuen Token generieren
                        </button>
                    </div>
                </div>
            </div>    
            
            <!-- System-Einstellungen Section (nur Admin) -->
            <div class="content-section" id="einstellungen">
                <div class="content-header">
                    <h1>Systemeinstellungen</h1>
                    <button class="btn-add" id="saveSettingsBtn">üíæ Speichern</button>
                </div>

                <div class="settings-container">
                    <!-- Allgemein -->
                    <div class="settings-card">
                        <h3>Allgemein</h3>
                        <div class="settings-item">
                            <label>Name der Organisation</label>
                            <input type="text" id="setting_organization_name" class="setting-input" data-key="organization_name">
                        </div>
                    </div>

                    <!-- Erscheinungsbild -->
                    <div class="settings-card">
                        <h3>Erscheinungsbild</h3>
                        <div class="settings-item">
                            <label>Prim√§rfarbe</label>
                            <input type="color" id="setting_primary_color" class="setting-input" data-key="primary_color">
                        </div>
                        <div class="settings-item">
                            <label>Hintergrundfarbe</label>
                            <input type="color" id="setting_background_color" class="setting-input" data-key="background_color">
                        </div>
                    </div>

                    <!-- Paginierung -->
                    <div class="settings-card">
                        <h3>Paginierung</h3>
                        <div class="settings-item">
                            <label>Datenreihen pro Seite</label>
                            <input type="number" 
                                id="entries_per_page" 
                                class="setting-input" 
                                data-key="pagination_limit" 
                                min="10" 
                                max="100" 
                                step="5"
                                required>
                            <small class="input-hint">(Werte zwischen 10 und 100 in 5er Schritten)</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Termine Section -->
            <div class="content-section" id="termine">
                <div class="content-header">
                    <h1>Terminverwaltung</h1>                    
                     <div class="header-actions">
                        <button class="btn-secondary" data-role="admin" onclick="openAppointmentsImportModal()">üì§ Import CSV</button>
                        <button class="btn-secondary" data-role="manager" onclick="exportAppointments()">üíæ Export CSV</button>                                    
                        <button class="btn-add" data-role="manager" onclick="openAppointmentModal()">+ Neuer Termin</button>
                     </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Vergangene Termine</h3>
                        <div class="number" id="statPastAppointments">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Kommende Termine</h3>
                        <div class="number" id="statUpcomingAppointments">-</div>
                    </div>
                    <div class="stat-card" style="background: var(--bg-light); border-left-color: var(--info-color);">
                        <h3>Jahr filtern</h3>
                        <select id="appointmentYearFilter"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-md); font-size: 16px; font-weight: 600; cursor: pointer;">
                        </select>
                    </div>
                </div>

                <!-- Kalenderansicht -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="previousMonth()">‚Äπ</button>
                        <h2 id="calendarMonthYear">November 2025</h2>                        
                        <button class="calendar-nav" onclick="goToToday()" 
                                style="margin-left: 10px; padding: 8px 16px; font-size: 14px;"
                                title="Zum aktuellen Monat springen">
                            Heute
                        </button>
                        <button class="calendar-nav" onclick="nextMonth()">‚Ä∫</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-day-header">Mo</div>
                        <div class="calendar-day-header">Di</div>
                        <div class="calendar-day-header">Mi</div>
                        <div class="calendar-day-header">Do</div>
                        <div class="calendar-day-header">Fr</div>
                        <div class="calendar-day-header">Sa</div>
                        <div class="calendar-day-header">So</div>
                    </div>
                    <div id="calendarDaysContainer"></div>
                </div>
                
                 <!-- Pagination OBEN -->
                <div id="appointmentsPagination"></div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Termin</th>
                                <th>Terminart</th>
                                <th>Beschreibung</th>                                
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="appointmentsTableBody">
                            <tr><td colspan="4" class="loading">Lade Daten...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Anwesenheit Section -->
            <div class="content-section" id="anwesenheit">
                <div class="content-header">
                    <h1>Anwesenheitsverwaltung</h1>
                    <div class="header-actions">                        
                        <button class="btn-secondary" data-role="admin" onclick="openRecordsImportModal()">üì§ Import CSV</button>                  
                        <button class="btn-secondary" data-role="manager" onclick="exportRecords()">üíæ Export CSV</button>  
                        <button class="btn-add" data-role="manager" onclick="openRecordModal()">+ Anwesenheit erfassen</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Erfasste Anwesenheiten</h3>
                        <div class="number" id="statTotalRecords">-</div>
                    </div>
                    <div class="stat-card" style="background: var(--bg-light); border-left-color: var(--info-color);">
                        <h3>Jahr filtern</h3>
                        <select id="recordYearFilter"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-md); font-size: 16px; font-weight: 600; cursor: pointer;">
                        </select>
                    </div>
                </div>

                <!-- Filter-Leiste -->
                <div class="filter-bar">
                    <div class="form-group">
                        <label for="filterAppointment">Filter nach Termin:</label>
                        <select id="filterAppointment"> <!-- onchange="applyRecordFilters()"> -->
                            <option value="">Alle Termine</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterMember">Filter nach Mitglied:</label>
                        <select id="filterMember" ><!--onchange="applyRecordFilters()"> -->
                            <option value="">Alle Mitglieder</option>
                        </select>
                    </div>
                    <button class="btn-reset-filter" onclick="resetRecordFilter()">Filter zur√ºcksetzen</button>
                </div>

                 <!-- Pagination OBEN -->
                <div id="recordsPagination"></div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Termin</th>
                                <th>Terminart</th>
                                <th>Mitglied</th>
                                <th>Ankunftszeit</th>
                                <th>Status</th>
                                <th>Quelle</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTableBody">
                            <tr><td colspan="7" class="loading">Lade Daten...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Antr√§ge/Exceptions Section -->
            <div class="content-section" id="antraege">
                <div class="content-header">
                    <h1>Antr√§ge & Entschuldigungen</h1>
                    <button class="btn-add" onclick="openExceptionModal()">+ Neuer Antrag</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Ausstehende Antr√§ge</h3>
                        <div class="number" id="statPendingExceptions">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Genehmigte Antr√§ge</h3>
                        <div class="number" id="statApprovedExceptions">-</div>
                    </div>
                    <div class="stat-card" style="background: var(--bg-light); border-left-color: var(--info-color);">
                        <h3>Jahr filtern</h3>
                        <select id="exceptionYearFilter"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-md); font-size: 16px; font-weight: 600; cursor: pointer;">                            
                        </select>
                    </div>
                </div>

                <!-- Filter-Leiste -->
                <div class="filter-bar">
                    <div class="form-group">
                        <label for="filterExceptionStatus">Status:</label>
                        <select id="filterExceptionStatus">
                            <option value="">Alle</option>
                            <option value="pending">Ausstehend</option>
                            <option value="approved">Genehmigt</option>
                            <option value="rejected">Abgelehnt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterExceptionType">Typ:</label>
                        <select id="filterExceptionType">
                            <option value="">Alle</option>
                            <option value="absence">Entschuldigung</option>
                            <option value="time_correction">Zeitkorrektur</option>
                        </select>
                    </div>
                    <button id="resetExceptionFilter" class="btn-reset-filter">Filter zur√ºcksetzen</button>
                </div>                
                 <!-- Pagination OBEN -->
                <div id="exceptionsPagination"></div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Typ</th>
                                <th>Mitglied</th>
                                <th>Termin</th>
                                <th>Begr√ºndung</th>
                                <th>Gew√ºnschte Zeit</th>
                                <th>Status</th>
                                <th>Erstellt am</th>
                            </tr>
                        </thead>
                        <tbody id="exceptionsTableBody">
                            <tr><td colspan="7" class="loading">Lade Daten...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>  

            <!-- Statistik Sektion -->
            <section class="content-section" id="statistik">
                <div class="content-header">
                    <h1>Statistik</h1>
                </div>                          
                <div class="stats-header">
                    <div class="filter-card">
                        <div class="filter-grid">
                            <div class="form-group">
                                <label for="statGroup">Gruppe</label>
                                <select id="statGroup" class="form-input">
                                    <option value="">Alle Gruppen</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="statMemberFilterGroup" style="display:none;">
                                <label for="statMember">Mitglied</label>
                                <select id="statMember" class="form-input">
                                    <option value="">Alle Mitglieder</option>
                                </select>
                            </div>
                        </div>
                    </div>                
                    <div class="year-card">
                        <h3>Jahr filtern</h3>
                        <select id="statisticYearFilter" class="form-input year-select">
                        </select>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Termine gesamt</h3>
                        <div class="number" id="statTotalAppointments">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Anwesend</h3>
                        <div class="number" id="statTotalPresent">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Entschuldigt</h3>
                        <div class="number" id="statTotalExcused">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Unentschuldigt</h3>
                        <div class="number" id="statTotalUnexcused">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Durchschnitt</h3>
                        <div class="number" id="statOverallAverage">-</div>
                    </div>
                </div>

                <div id="statisticsContainer"></div>
            </section>
            
            <!-- Mitglieder Section (nur Admin)-->
            <div class="content-section active" id="mitglieder">
                <div class="content-header">
                    <h1>Mitgliederverwaltung</h1> 
                    <div class="header-actions">                        
                        <button class="btn-secondary" data-role="admin" onclick="openImportModal()">üì§ Import CSV</button>
                        <button class="btn-secondary" data-role="manager" onclick="exportMembers()">üíæ Export CSV</button>            
                        <button class="btn-add" data-role="manager" onclick="openMemberModal()">+ Neues Mitglied</button>                    
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Aktive Mitglieder</h3>
                        <div class="number" id="statActiveMembersCount">-</div>                                             
                    </div>
                    <div class="stat-card" style="background: var(--bg-light); border-left-color: var(--info-color);">
                        <h3>Jahr filtern</h3>
                        <select id="memberYearFilter"
                                style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: var(--radius-md); font-size: 16px; font-weight: 600; cursor: pointer;">
                        </select>
                    </div>
                </div>

                 <!-- Pagination OBEN -->
                <div id="membersPagination"></div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Vorname</th>
                                <th>Mitgliedsnummer</th>
                                <th>Gruppen</th>
                                <th>Status</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <tr><td colspan="6" class="loading">Lade Daten...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Benutzer-Verwaltung Section (nur Admin) -->
            <div class="content-section" id="benutzer">
                <div class="content-header">
                    <h1>Benutzerverwaltung</h1>
                    <button class="btn-add" onclick="openUserModal()">+ Neuer Benutzer</button>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Gesamte Nutzer</h3>
                        <div class="number" id="statTotalUsers">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Aktive Nutzer</h3>
                        <div class="number" id="statActiveUsers">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ger√§te</h3>
                        <div class="number" id="statDeviceUsers">-</div>
                    </div>
                </div>
                
                <!-- Filter Container (NEU) -->
                <div class="filter-bar">
                    <div class="form-group">
                        <label for="filterUserRole">Rolle</label>
                        <select id="filterUserRole" class="form-input">
                            <option value="">Alle Rollen</option>
                            <option value="admin">Administrator</option>
                            <option value="manager">Manager</option>
                            <option value="user">Benutzer</option>
                            <option value="device">Ger√§t</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="filterUserStatus">Status</label>
                        <select id="filterUserStatus" class="form-input">
                            <option value="">Alle Status</option>
                            <option value="active">Aktiv</option>
                            <option value="inactive">Inaktiv</option>
                        </select>
                    </div>
                    
                    <button id="resetUserFilters" class="btn-reset-filter">
                        Filter zur√ºcksetzen
                    </button>
                </div>

                 <!-- Pagination OBEN -->
                <div id="usersPagination"></div>

                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>E-Mail</th>
                                <th>Rolle</th>
                                <th>Verkn√ºpftes Mitglied</th>
                                <th>Status</th>
                                <th>Erstellt am</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr><td colspan="6" class="loading">Lade Daten...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Verwaltung Section (nur Admin) -->
            <div class="content-section" id="verwaltung">
                <div class="content-header">
                    <h1>Gruppen & Terminarten</h1>
                </div>

                <!-- Benutzergruppen -->
                <div class="data-table">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">üë• Benutzergruppen</h2>
                        <button class="btn-add" onclick="openGroupModal()">+ Neue Gruppe</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Gruppenname</th>
                                <th>Beschreibung</th>                                
                                <th>Anzahl Mitglieder</th>
                                <th>Standard</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="groupsTableBody">
                            <tr><td colspan="5" class="loading">Lade Daten...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Terminarten -->
                <div class="data-table" style="margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">üìÖ Terminarten</h2>
                        <button class="btn-add" onclick="openTypeModal()">+ Neue Terminart</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Terminart</th>
                                <th>Beschreibung</th>
                                <th>Farbe</th>
                                <th>Betroffene Gruppen</th>
                                <th>Standard</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="typesTableBody">
                            <tr><td colspan="6" class="loading">Lade Daten...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

        <!-- ENDE MAIN ---->
        </main>
    </div>

    <!-- MODALS ---------------------  -->

    <!-- Modal f√ºr Mitglieder -->
    <div class="modal" id="memberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="memberModalTitle">Neues Mitglied</h2>
                <button class="close-modal" onclick="closeMemberModal()">√ó</button>
            </div>
            <div class="modal-body">                
                <form id="memberForm">
                    <input type="hidden" id="member_id">                
                    <div class="form-group">
                        <label>       
                            <input type="checkbox" id="member_active" checked readonly>
                            <span>Aktiv</span>
                        </label>
                    </div> 
                    <div class="form-group">
                        <label for="member_name">Vorname*</label>
                        <input type="text" id="member_name" required>
                    </div>
                    <div class="form-group">
                        <label for="member_surname">Nachname*</label>
                        <input type="text" id="member_surname" required>
                    </div>
                    <div class="form-group">
                        <label for="member_number">Mitgliedsnummer</label>
                        <input type="text" id="member_number">
                    </div>
                    <div class="form-group">
                        <label>Gruppenzugeh√∂rigkeit</label>
                        <small style="color: #7f8c8d; display: block; margin-bottom: 10px;">
                            W√§hle die Gruppen aus, denen dieses Mitglied angeh√∂rt
                        </small>
                        <div id="memberGroupsList" style="border: 1px solid #ddd; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto;">

                        </div>
                    </div>                                       
                    <div class="form-group" id="membershipDatesGroup" style="display: none;">
                        <label>Mitgliedschaftszeitr√§ume</label>
                        <div id="membershipDatesList"></div>
                        <button type="button" class="btn-add" onclick="addMembershipDate()" style="margin-top: 10px;">
                            + Zeitraum hinzuf√ºgen
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeMemberModal()">Abbrechen</button>
                <button class="btn-save" onclick="saveMember()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Modal f√ºr Termine -->
    <div class="modal" id="appointmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="appointmentModalTitle">Neuer Termin</h2>
                <button class="close-modal" onclick="closeAppointmentModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="appointmentForm">
                    <input type="hidden" id="appointment_id">
                    <div class="form-group">
                        <label for="appointment_title">Titel*</label>
                        <input type="text" id="appointment_title" required>
                    </div>
                    <div class="form-group">
                        <label for="appointment_type">Terminart*</label>
                        <select id="appointment_type" required>
                            <option value="">Bitte w√§hlen...</option>
                        </select>
                        <small style="color: #7f8c8d; display: block; margin-top: 5px;">
                            Legt fest, welche Mitgliedergruppen betroffen sind
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="appointment_description">Beschreibung</label>
                        <textarea id="appointment_description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="appointment_date">Datum*</label>
                        <input type="date" id="appointment_date" required>
                    </div>
                    <div class="form-group">
                        <label for="appointment_time">Startzeit*</label>
                        <input type="time" id="appointment_time" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeAppointmentModal()">Abbrechen</button>
                <button class="btn-save" onclick="saveAppointment()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Modal f√ºr Anwesenheiten -->
    <div class="modal" id="recordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="recordModalTitle">Anwesenheit erfassen</h2>
                <button class="close-modal" onclick="closeRecordModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="recordForm">
                    <input type="hidden" id="record_id">
                    <div class="form-group">
                        <label for="record_member">Mitglied*</label>
                        <select id="record_member" required>
                            <option value="">Bitte w√§hlen...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="record_appointment">Termin*</label>
                        <select id="record_appointment" required>
                            <option value="">Bitte w√§hlen...</option>
                        </select>
                    </div>
                    <!-- Terminart-Anzeige  -->
                    <div class="form-group" id="recordAppointmentTypeGroup" style="display: none;">
                        <div id="recordAppointmentTypeDisplay" style="padding: 10px; background: #f8f9fa; border-radius: 4px;">
                            <span id="recordAppointmentTypeBadge"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="record_arrival_time">Ankunftszeit*</label>
                        <input type="datetime-local" id="record_arrival_time" required>
                    </div>
                    <div class="form-group">
                        <label for="record_status">Status*</label>
                        <select id="record_status" required>
                            <option value="present">Anwesend</option>
                            <option value="excused">Entschuldigt</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeRecordModal()">Abbrechen</button>
                <button class="btn-save" onclick="saveRecord()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Modal f√ºr Antr√§ge/Exceptions -->
    <div class="modal" id="exceptionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="exceptionModalTitle">Neuer Antrag</h2>
                <button class="close-modal" onclick="closeExceptionModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="exceptionForm">
                    <input type="hidden" id="exception_id">
                    
                    <div class="form-group" id="exceptionMemberGroup">
                        <label for="exception_member">Mitglied*</label>
                        <select id="exception_member">
                            <option value="">Bitte w√§hlen...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="exception_appointment">Termin*</label>
                        <select id="exception_appointment" required>
                            <option value="">Bitte w√§hlen...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="exception_type">Art des Antrags*</label>
                        <select id="exception_type" required onchange="toggleExceptionFields()">
                            <option value="absence">Entschuldigung</option>
                            <option value="time_correction">Zeitkorrektur</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="requestedTimeGroup" style="display: none;">
                        <label for="exception_requested_time">Gew√ºnschte Ankunftszeit</label>
                        <input type="datetime-local" id="exception_requested_time">
                    </div>
                    
                    <div class="form-group">
                        <label for="exception_reason">Begr√ºndung*</label>
                        <textarea id="exception_reason" rows="4" required></textarea>
                    </div>
                    
                    <!-- Nur f√ºr Admin sichtbar -->
                    <div class="form-group" id="exceptionStatusGroup" style="display: none;">
                        <label for="exception_status">Status*</label>
                        <select id="exception_status">
                            <option value="pending">Ausstehend</option>
                            <option value="approved">Genehmigt</option>
                            <option value="rejected">Abgelehnt</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeExceptionModal()">Abbrechen</button>
                <button class="btn-save" onclick="saveException()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Modal f√ºr Benutzer -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="userModalTitle">Neuer Benutzer</h2>
                <button class="close-modal" onclick="closeUserModal()">√ó</button>
            </div>
            <div class="modal-body">                
                <form id="userForm">
                    <input type="hidden" id="user_id">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="user_active" checked>
                            <span>Aktiv</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="user_email">E-Mail / Ger√§te-Name*</label>
                        <input type="text" id="user_email" required>
                        <small>Bei Ger√§ten: z.B. "nfc-reader-entrance"</small>
                    </div>
                    <div class="form-group">
                        <label for="user_password">Passwort</label>
                        <input type="password" id="user_password">
                        <small>Leer lassen um bestehendes Passwort zu behalten. Ger√§te ben√∂tigen kein Passwort.</small>
                    </div>                    
                    <div class="form-group">
                        <label for="user_role">Rolle*</label>
                        <select id="user_role" required>
                            <option value="user">Benutzer</option>                        
                            <option value="manager">Manager</option>
                            <option value="admin">Administrator</option>
                            <option value="device">Ger√§t (TOTP/Terminal)</option>
                        </select>
                    </div>
                    <div class="form-group" id="userMemberGroup">
                        <label for="user_member">Verkn√ºpftes Mitglied</label>
                        <select id="user_member">
                            <option value="">Kein Mitglied</option>
                        </select>
                    </div>
                    <div class="form-group" id="userDeviceTypeGroup" style="display: none;">
                        <label for="user_device_type">Ger√§te-Typ*</label>
                        <select id="user_device_type" required>
                            <option value="">Bitte w√§hlen...</option>
                            <option value="totp_location">üî¢ TOTP-Location (User-Authentifizierung)</option>
                            <option value="auth_device">üîê Auth-Device (Member-Authentifizierung)</option>
                        </select>
                        <small id="deviceTypeHint" style="display: block; margin-top: 5px; color: #7f8c8d;"></small>
                    </div>

                    <!-- TOTP Secret nur bei totp_location -->
                    <div class="form-group" id="userTotpSecretGroup" style="display: none;">
                        <label for="user_totp_secret">TOTP Secret (Base32)*</label>
                        <input type="text" id="user_totp_secret" maxlength="255" style="font-family: monospace;">
                        <button type="button" onclick="generateTotpSecret()" class="btn-add" style="margin-top: 5px;">
                            üîÑ Secret generieren
                        </button>
                        <small>Wird f√ºr TOTP-basierte Standortverifizierung ben√∂tigt</small>
                    </div>                    

                    <!-- API-Token Anzeige (nur f√ºr Devices und nach Erstellung) -->
                    <div class="form-group" id="userTokenGroup" style="display: none;">
                        <label>API-Token</label>
                        <p style="color: #7f8c8d; margin-bottom: 10px; font-size: 12px;">
                            Dieser Token wird f√ºr die API-Authentifizierung ben√∂tigt
                        </p>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="flex: 1; position: relative;">
                                <input type="password" id="user_token" readonly class="token-hidden" 
                                    style="width: 100%; padding: 10px 40px 10px 10px; font-family: monospace; background: #f8f9fa;">
                                <button onclick="toggleUserTokenVisibility()" id="toggleUserTokenBtn" type="button"
                                        style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 20px; padding: 5px 10px; color: #7f8c8d;">
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <button onclick="copyUserToken()" type="button" class="btn-add" style="margin: 0; width: auto;">üìã</button>
                        </div>
                        <!-- Im userTokenGroup nach dem Token-Input -->
                        <div id="tokenExpiryInfo" style="display: block; margin-top: 5px; font-size: 12px;"></div>
                        <button onclick="regenerateUserToken()" type="button" class="action-btn btn-delete" style="margin-top: 10px;">
                            üîÑ Neuen Token generieren
                        </button>
                        <p style="color: #e74c3c; font-size: 12px; margin-top: 10px;">
                            ‚ö†Ô∏è Token nach Erstellung sicher aufbewahren!
                        </p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeUserModal()">Abbrechen</button>
                <button class="btn-save" onclick="saveUser()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Modal f√ºr Benutzergruppen -->
    <div class="modal" id="groupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="groupModalTitle">Neue Gruppe</h2>
                <button class="close-modal" onclick="closeGroupModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="groupForm">
                    <input type="hidden" id="group_id">
                    <div class="form-group">
                        <label for="group_name">Gruppenname*</label>
                        <input type="text" id="group_name" required>
                    </div>
                    <div class="form-group">
                        <label for="group_description">Beschreibung</label>
                        <textarea id="group_description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="group_is_default">
                            <span>Standard-Gruppe (gilt f√ºr alle neuen Mitglieder)</span>                            
                        </label>
                        <small style="color: #e67e22; display: block; margin-top: 5px;">
                            ‚ö†Ô∏è Nur eine Gruppe kann Standard sein. Diese sollte alle Mitglieder umfassen.
                        </small>
                    </div>
                    <div class="form-group" id="groupMembersGroup" style="display: none;">
                        <label>Mitglieder in dieser Gruppe</label>
                        <div id="groupMembersList" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeGroupModal()">Abbrechen</button>
                <button class="btn-save" onclick="saveGroup()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Modal f√ºr Terminarten -->
    <div class="modal" id="typeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="typeModalTitle">Neue Terminart</h2>
                <button class="close-modal" onclick="closeTypeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="typeForm">
                    <input type="hidden" id="type_id">
                    <div class="form-group">
                        <label for="type_name">Terminart*</label>
                        <input type="text" id="type_name" required placeholder="z.B. Probe, Konzert">
                    </div>
                    <div class="form-group">
                        <label for="type_description">Beschreibung</label>
                        <textarea id="type_description" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="type_color">Farbe</label>
                        <input type="color" id="type_color" value="#667eea">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="type_is_default">
                            <span>Standard-Terminart (f√ºr Auto-Erfassung ohne Termin)</span>
                        </label>
                        <small style="color: #e67e22; display: block; margin-top: 5px;">
                            ‚ö†Ô∏è Nur eine Terminart kann Standard sein. Diese muss die Standard-Gruppe "Alle Mitglieder" enthalten.
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Betroffene Gruppen*</label>
                        <small style="color: #7f8c8d; display: block; margin-bottom: 10px;">
                            Mitglieder dieser Gruppen sollten zu Terminen dieser Art anwesend sein
                        </small>
                        <div id="typeGroupsList" style="border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeTypeModal()">Abbrechen</button>
                <button class="btn-save" onclick="saveType()">Speichern</button>
            </div>
        </div>
    </div>

        <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2 id="confirmTitle">Best√§tigung</h2>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Sind Sie sicher?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="confirmCancel">Abbrechen</button>
                <button class="btn-confirm-delete" id="confirmOk">OK</button>
            </div>
        </div>
    </div>

    <!-- Member Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mitglieder importieren (CSV)</h2>
                <span class="modal-close" onclick="closeImportModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="import-info">
                    <h3>CSV-Format:</h3>
                    <p>Die CSV-Datei muss folgende Spalten enthalten:</p>
                    <ul>
                        <li><strong>name</strong> - Pflichtfeld</li>
                        <li><strong>surname</strong> - Pflichtfeld</li>
                        <li><strong>member_number</strong> - Optional, f√ºr eindeutige Zuordnung empfohlen</li>
                        <li><strong>active</strong> - 1 oder 0</li>
                        <li><strong>groups</strong> - Gruppennamen getrennt durch |</li>
                    </ul>
                    <p><strong>Trennzeichen:</strong> Semikolon (;)</p>
                    <p><strong>Encoding:</strong> UTF-8</p>
                </div>
                
                <div class="form-group">
                    <label for="importFile">CSV-Datei ausw√§hlen:</label>
                    <input type="file" id="importFile" accept=".csv" class="file-input">
                </div>
                
                <div id="importProgress" style="display:none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="importProgressFill"></div>
                    </div>
                    <p id="importStatus">Importiere...</p>
                </div>
                
                <div id="importResult" style="display:none;">
                    <h3>Import-Ergebnis:</h3>
                    <div id="importResultContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeImportModal()">Abbrechen</button>
                <button class="btn-save" id="importBtn" onclick="executeImport()">Importieren</button>
            </div>
        </div>
    </div>

    <!-- Appointments Import Modal -->
    <div class="modal" id="appointmentsImportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Termine importieren (CSV)</h2>
                <span class="modal-close" onclick="closeAppointmentsImportModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="import-info">
                    <h3>CSV-Format:</h3>
                    <p>Die CSV-Datei muss folgende Spalten enthalten:</p>
                    <ul>
                        <li><strong>date</strong> - Pflichtfeld (Format: YYYY-MM-DD)</li>
                        <li><strong>start_time</strong> - Pflichtfeld (Format: HH:MM:SS)</li>
                        <li><strong>title</strong> - Pflichtfeld</li>
                        <li><strong>type_name</strong> - Pflichtfeld (Name der Terminart)</li>
                        <li><strong>description</strong> - Optional</li>
                    </ul>
                    <p><strong>Hinweis:</strong> Die Terminart muss bereits existieren.</p>
                    <p><strong>Trennzeichen:</strong> Semikolon (;)</p>
                    <p><strong>Encoding:</strong> UTF-8</p>
                </div>
                
                <div class="form-group">
                    <label for="appointmentsImportFile">CSV-Datei ausw√§hlen:</label>
                    <input type="file" id="appointmentsImportFile" accept=".csv" class="file-input">
                </div>
                
                <div id="appointmentsImportProgress" style="display:none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="appointmentsImportProgressFill"></div>
                    </div>
                    <p id="appointmentsImportStatus">Importiere...</p>
                </div>
                
                <div id="appointmentsImportResult" style="display:none;">
                    <h3>Import-Ergebnis:</h3>
                    <div id="appointmentsImportResultContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeAppointmentsImportModal()">Abbrechen</button>
                <button class="btn-save" id="appointmentsImportBtn" onclick="executeAppointmentsImport()">Importieren</button>
            </div>
        </div>
    </div>

    <!-- Records Import Modal -->
    <div class="modal" id="recordsImportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Anwesenheiten importieren (CSV)</h2>
                <span class="modal-close" onclick="closeRecordsImportModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Tab-Navigation -->
                <div class="import-tabs">
                    <button class="tab-btn active" onclick="switchImportTab('records')">Records Importieren</button>
                    <button class="tab-btn" onclick="switchImportTab('analyze')">Termine Vorschlagen</button>
                </div>

                <!-- Tab 1: Bestehender Records-Import -->
                <div id="import-tab-records" class="import-tab-content active">
                    <!-- Dein bestehender Import-Code bleibt hier -->
                    <form id="importForm">
                        <div class="import-info">
                            <h3>CSV-Format:</h3>
                            <p>Die CSV-Datei muss folgende Spalten enthalten:</p>
                            <ul>
                                <li><strong>member_number</strong> - Pflichtfeld (Mitgliedsnummer)</li>
                                <li><strong>arrival_date_time</strong> - Pflichtfeld (Format: YYYY-MM-DD HH:MM:SS)</li>
                                <li><strong>status</strong> - Optional (present/excused, Standard: present)</li>
                            </ul>
                            <p><strong>Hinweis:</strong> Das System sucht automatisch passende Termine am angegebenen Datum.</p>
                            <p><strong>Trennzeichen:</strong> Semikolon (;)</p>
                            <p><strong>Encoding:</strong> UTF-8</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="recordsImportFile">CSV-Datei ausw√§hlen:</label>
                            <input type="file" id="recordsImportFile" accept=".csv" class="file-input">
                        </div>
                        
                        <div id="recordsImportProgress" style="display:none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="recordsImportProgressFill"></div>
                            </div>
                            <p id="recordsImportStatus">Importiere...</p>
                        </div>
                        
                        <div id="recordsImportResult" style="display:none;">
                            <h3>Import-Ergebnis:</h3>
                            <div id="recordsImportResultContent"></div>
                        </div>
                    </form>
                </div>

                <!-- Tab 2: Neuer Termin-Analyse -->
                <div id="import-tab-analyze" class="import-tab-content" style="display:none;">
                    <form id="analyzeForm">
                        <div class="import-info">
                            <h3>CSV-Format:</h3>
                            <p>Die CSV-Datei muss folgende Spalten enthalten:</p>
                            <ul>
                                <li><strong>member_number</strong> - Mitgliedsnummer</li>
                                <li><strong>arrival_date_time</strong> - Format: YYYY-MM-DD HH:MM:SS</li>
                            </ul>
                            <p><strong>Hinweis:</strong> Auf Basis der Eintr√§ge werden passende Termine vorgeschlagen.</p>
                            <p><strong>Trennzeichen:</strong> Semikolon (;)</p>
                            <p><strong>Encoding:</strong> UTF-8</p>
                        </div>
                        <div class="form-group">
                            <label for="csv-analyze-file">CSV-Datei mit Zeitstempeln:</label>
                            <input type="file" id="csv-analyze-file" accept=".csv" required class="file-input">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="min-records">Mindestanzahl Records:</label>
                                <input type="number" id="min-records" value="5" min="1">
                            </div>
                            
                            <div class="form-group">
                                <label for="round-minutes">Startzeit runden auf:</label>
                                <select id="round-minutes">
                                    <option value="15">15 Minuten</option>
                                    <option value="30">30 Minuten</option>
                                    <option value="60">60 Minuten</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="button" class="btn-save" onclick="analyzeCsvForAppointments()">Analysieren</button>
                    </form>
                    
                    <div id="suggestions-container" style="display:none; margin-top: 20px;">
                        <h3>Vorgeschlagene Termine <span id="suggestion-count"></span></h3>
                        <div id="suggestions-list" class="suggestions-list"></div>
                        
                        <div class="form-actions" style="margin-top: 20px;">
                            <button onclick="createSelectedAppointments()" class="btn-save">
                                Ausgew√§hlte Termine anlegen
                            </button>
                            <button onclick="clearSuggestions()" class="btn-secondary">
                                Verwerfen
                            </button>
                        </div>
                    </div> 
                </div>               
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeRecordsImportModal()">Abbrechen</button>
                <button class="btn-save" id="recordsImportBtn" onclick="executeRecordsImport()">Importieren</button>
            </div>
        </div>
    </div>

    <!-- QR Code Generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Konfiguration -->
    <script type="module" src="./js/config.js"></script>

    <!-- Module -->
    <script type="module" src="./js/modules/utils.js"></script>
    <script type="module" src="./js/modules/api.js"></script>
    <script type="module" src="./js/modules/ui.js"></script>
    <script type="module" src="./js/modules/auth.js"></script>
    <script type="module" src="./js/modules/members.js"></script>
    <script type="module" src="./js/modules/appointments.js"></script>
    <script type="module" src="./js/modules/records.js"></script>
    <script type="module" src="./js/modules/exceptions.js"></script>
    <script type="module" src="./js/modules/users.js"></script>
    <script type="module" src="./js/modules/profile.js"></script>
    <script type="module" src="./js/modules/management.js"></script>
    <script type="module" src="./js/modules/statistics.js"></script>
    <script type="module" src="./js/modules/import_export.js"></script>

    <!-- Hauptdatei -->
    <script type="module" src="./js/app.js"></script>

    <script>
        (async function checkInstallation() {
            try {
                // Pr√ºfe ob API erreichbar und DB konfiguriert ist
                const response = await fetch('./api/api.php?resource=ping', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                // Wenn "not_installed" Status ‚Üí Weiterleitung
                if (result.status === 'not_installed') {
                    console.log('Installation erforderlich - Weiterleitung...');
                    window.location.href = './install/';
                }
            } catch (error) {
                // Bei Fehler auch zur Installation
                console.warn('API nicht erreichbar - pr√ºfe Installation');
                
                // Versuche Installation zu erreichen
                try {
                    const installCheck = await fetch('./install/index.php');
                    if (installCheck.ok) {
                        window.location.href = './install/';
                    }
                } catch (e) {
                    console.error('Weder API noch Installation erreichbar');
                }
            }
        })();
        </script>

</body>
</html>